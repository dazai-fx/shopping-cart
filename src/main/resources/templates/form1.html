<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Step 1 of 3 - Shopping Cart</title>
    <link rel="stylesheet" type="text/css" th:href="@{/webjars/bootstrap/5.3.3/css/bootstrap.min.css}">
    <script th:src="@{/webjars/bootstrap/5.3.3/js/bootstrap.bundle.min.js}"></script>
    <script type="module" th:src="@{/js/Step1.js}"></script>
</head>
<body class="bg-light">

<div class="container-lg py-5">
    <div class="card shadow-lg border-0 rounded-4">
        <div class="card-body p-4">

            <h2 class="text-center mb-4 fw-bold">
                Step 1 of 3 - Shopping Cart
            </h2>

            <form th:action="@{/step2}" method="post" th:object="${customerOrderDTO}" id="form-1">

                <!-- Modal para los errores -->

                <div class="modal fade" id="errorModal" tabindex="-1">
                    <div class="modal-dialog">
                        <div class="modal-content">

                            <div class="modal-header bg-danger text-white">
                                <h5 class="modal-title">Errors in the form</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>

                            <div class="modal-body">
                                <ul>
                                    <li th:each="err : ${#fields.errors('*')}"
                                        th:text="${err}">
                                    </li>
                                </ul>
                            </div>

                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary"
                                        data-bs-dismiss="modal">
                                    Cerrar
                                </button>
                            </div>

                        </div>
                    </div>
                </div>

                <script th:if="${#fields.hasErrors('*')}">
                    document.addEventListener("DOMContentLoaded", function() {
                        var errorModal = new bootstrap.Modal(document.getElementById('errorModal'));
                        errorModal.show();
                    });
                </script>

                <!-- PRODUCTS TABLE -->
                <div class="mb-5">
                    <h4 class="mb-3">Products in your cart</h4>

                    <div class="table-responsive">
                        <table class="table table-hover align-middle" id="products-table">
                            <thead class="table-light text-center">
                            <tr>
                                <th class="text-start">Product Name</th>
                                <th class="text-end">Unit Price</th>
                                <th class="text-center">Quantity</th>
                                <th class="text-end">Subtotal</th>
                                <th class="text-center">Actions</th>
                            </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- ADD PRODUCT -->
                <div class="mb-5 p-4 bg-light rounded-3 border">
                    <h4 class="mb-3">Add new product</h4>

                    <div class="row g-3 align-items-end">
                        <div class="col-md-4">
                            <label class="form-label">Name</label>
                            <input type="text" class="form-control" id="product-name">
                        </div>

                        <div class="col-md-3">
                            <label class="form-label">Price</label>
                            <input type="text" class="form-control" id="product-price">
                        </div>

                        <div class="col-md-3">
                            <label class="form-label">Qty</label>
                            <input type="text" class="form-control" id="product-qty">
                        </div>

                        <div class="col-md-2 d-grid">
                            <button type="button" class="btn btn-success" id="add-product-btn">
                                Add
                            </button>
                        </div>
                    </div>
                </div>

                <!-- DISCOUNT -->
                <div class="mb-5 p-4 bg-light rounded-3 border" id="coupon-service">
                    <h4 class="mb-3">Discount</h4>

                    <div class="row g-3 align-items-end">
                        <div class="col-md-6">
                            <label class="form-label">Discount coupon</label>
                            <input type="text" class="form-control" id="coupon">
                            <div id="coupon-feedback" class="invalid-feedback">
                                Invalid coupon. Please try again.
                            </div>
                        </div>

                        <div class="col-md-3 d-grid">
                            <button type="button" class="btn btn-outline-primary" id="coupon-button">
                                Apply
                            </button>
                        </div>
                    </div>

                    <p class="text-success mt-3 mb-0"
                       th:if="${hasDiscount}"
                       th:text="${hasDiscount}">
                    </p>
                </div>

                <!-- TOTALS -->
                <div class="row justify-content-left mb-4">
                    <div class="col-md-5">
                        <div class="card border-0 shadow-sm rounded-3">
                            <div class="card-body" id="cart-summary">
                                <div class="d-flex justify-content-between">
                                    <span>Gross total:</span>
                                    <span id="gross-total">0.00 €</span>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <span>Coupon discount:</span>
                                    <span id="discount-amount">0.00 €</span>
                                </div>
                                <hr>
                                <div class="d-flex justify-content-between fw-bold fs-5">
                                    <span>Total to pay:</span>
                                    <span id="total-to-pay">0.00 €</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Hidden inputs to submit via the form -->
                <div id="hidden-inputs-container"></div>

                <!-- CONTINUE BUTTON -->
                <div class="d-flex justify-content-center">
                    <button type="submit" class="btn btn-success btn-lg px-4">
                        Continue to step 2 >
                    </button>
                </div>

            </form>
        </div>
    </div>
</div>

</body>
</html>